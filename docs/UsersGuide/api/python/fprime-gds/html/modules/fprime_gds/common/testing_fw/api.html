

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fprime_gds.common.testing_fw.api &mdash; fprime-gds 1.4.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../static/css/rtd_width.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../static/documentation_options.js"></script>
        <script src="../../../../static/jquery.js"></script>
        <script src="../../../../static/underscore.js"></script>
        <script src="../../../../static/doctools.js"></script>
        <script src="../../../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> fprime-gds
          

          
          </a>

          
            
            
              <div class="version">
                1.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">fprime-gds</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../fprime_gds.html">fprime_gds</a> &raquo;</li>
        
      <li>fprime_gds.common.testing_fw.api</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fprime_gds.common.testing_fw.api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">gds_test_api.py:</span>

<span class="sd">This file contains basic asserts that can support integration tests on an FPrime</span>
<span class="sd">deployment. This API uses the standard pipeline to get access to commands, events,</span>
<span class="sd">telemetry and dictionaries.</span>

<span class="sd">:author: koran</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">fprime.common.models.serialize.time_type</span> <span class="kn">import</span> <span class="n">TimeType</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.handlers</span> <span class="kn">import</span> <span class="n">DataHandler</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.history.chrono</span> <span class="kn">import</span> <span class="n">ChronologicalHistory</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.history.test</span> <span class="kn">import</span> <span class="n">TestHistory</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.logger.test_logger</span> <span class="kn">import</span> <span class="n">TestLogger</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.testing_fw</span> <span class="kn">import</span> <span class="n">predicates</span>
<span class="kn">from</span> <span class="nn">fprime_gds.common.utils.event_severity</span> <span class="kn">import</span> <span class="n">EventSeverity</span>


<div class="viewcode-block" id="IntegrationTestAPI"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI">[docs]</a><span class="k">class</span> <span class="nc">IntegrationTestAPI</span><span class="p">(</span><span class="n">DataHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A value used to begin searches after the current contents in a history and only search future</span>
<span class="sd">    items</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IntegrationTestAPI.NOW"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.NOW">[docs]</a>    <span class="n">NOW</span> <span class="o">=</span> <span class="s2">&quot;NOW&quot;</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">logpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fsw_order</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes API: constructs and registers test histories.</span>
<span class="sd">        Args:</span>
<span class="sd">            pipeline: a pipeline object providing access to basic GDS functionality</span>
<span class="sd">            logpath: an optional output destination for the api test log</span>
<span class="sd">            fsw_order: a flag to determine whether the API histories will maintain FSW time order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>
        <span class="c1"># these are owned by the GDS and will not be modified by the test API.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_command_history</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">histories</span><span class="o">.</span><span class="n">commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_telemetry_history</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">histories</span><span class="o">.</span><span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_event_history</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">histories</span><span class="o">.</span><span class="n">events</span>

        <span class="c1"># these histories are owned by the TestAPI and are modified by the API.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsw_ordered</span> <span class="o">=</span> <span class="n">fsw_order</span>
        <span class="k">if</span> <span class="n">fsw_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command_history</span> <span class="o">=</span> <span class="n">ChronologicalHistory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span> <span class="o">=</span> <span class="n">ChronologicalHistory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span> <span class="o">=</span> <span class="n">ChronologicalHistory</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command_history</span> <span class="o">=</span> <span class="n">TestHistory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span> <span class="o">=</span> <span class="n">TestHistory</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span> <span class="o">=</span> <span class="n">TestHistory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_command_consumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command_history</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_event_consumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_history</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_channel_consumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span><span class="p">)</span>

        <span class="c1"># Initialize latest time. Will be updated whenever a time query is made.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latest_time</span> <span class="o">=</span> <span class="n">TimeType</span><span class="p">()</span>

        <span class="c1"># Initialize the logger</span>
        <span class="k">if</span> <span class="n">logpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">TestLogger</span><span class="p">(</span><span class="n">logpath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># A predicate used as a filter to choose which events to log automatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_log_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_event_consumer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Used by the data_callback method to detect if events have been received out of order.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_evr</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="IntegrationTestAPI.teardown"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.teardown">[docs]</a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To be called once at the end of the API&#39;s use. Closes the test log and clears histories.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_histories</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">close_log</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   API Functions</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.start_test_case"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.start_test_case">[docs]</a>    <span class="k">def</span> <span class="nf">start_test_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_name</span><span class="p">,</span> <span class="n">case_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To be called at the start of a test case. This function inserts a log message to denote a</span>
<span class="sd">        new test case is beginning, records the latest time stamp in case the user clears the</span>
<span class="sd">        aggregate histories, and then clears the API&#39;s histories.</span>

<span class="sd">        Args:</span>
<span class="sd">            case_name: the name of the test case (str)</span>
<span class="sd">            case_id: a short identifier to denote the test case (str or number)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;[STARTING CASE] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">case_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">GRAY</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="n">case_id</span><span class="o">=</span><span class="n">case_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_time</span><span class="p">()</span>  <span class="c1"># called in case aggregate histories are cleared by the user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_histories</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.log"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User-accessible function to log user messages to the test log.</span>
<span class="sd">        Args:</span>
<span class="sd">            msg: a user-provided message to add to the test log. (str)</span>
<span class="sd">            color: a string containing a color hex code &quot;######&quot; (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;API user&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_latest_time"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_latest_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_latest_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the latest flight software time received by either history.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a flight software timestamp (TimeType)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_event_history</span><span class="o">.</span><span class="n">retrieve</span><span class="p">()</span>
        <span class="n">e_time</span> <span class="o">=</span> <span class="n">TimeType</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">e_time</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

        <span class="n">channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_telemetry_history</span><span class="o">.</span><span class="n">retrieve</span><span class="p">()</span>
        <span class="n">t_time</span> <span class="o">=</span> <span class="n">TimeType</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t_time</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">latest_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e_time</span><span class="p">,</span> <span class="n">t_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_time</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.test_assert"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.test_assert">[docs]</a>    <span class="k">def</span> <span class="nf">test_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this assert gives the user the ability to add formatted assert messages to the test log and</span>
<span class="sd">        raise an assertion.</span>
<span class="sd">        Args:</span>
<span class="sd">            value: a boolean value that determines if the assert is successful.</span>
<span class="sd">            msg: a string describing what is checked by the assert.</span>
<span class="sd">            expect: when True, the call will behave as an expect, and will skip the assert (boolean)</span>
<span class="sd">        Return:</span>
<span class="sd">            True if the assert was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expect</span><span class="p">:</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="s2">&quot;User assertion&quot;</span>
            <span class="n">fail_color</span> <span class="o">=</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">RED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="s2">&quot;User expectation&quot;</span>
            <span class="n">fail_color</span> <span class="o">=</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">ORANGE</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="n">ast_msg</span> <span class="o">+</span> <span class="s2">&quot; succeeded: &quot;</span> <span class="o">+</span> <span class="n">msg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">ast_msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="n">ast_msg</span> <span class="o">+</span> <span class="s2">&quot; failed: &quot;</span> <span class="o">+</span> <span class="n">msg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">ast_msg</span><span class="p">,</span> <span class="n">fail_color</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">expect</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span><span class="p">,</span> <span class="n">ast_msg</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.predicate_assert"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.predicate_assert">[docs]</a>    <span class="k">def</span> <span class="nf">predicate_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        API assert gives the user the ability to add formatted assert messages to the test log and</span>
<span class="sd">        raise an assertion.</span>
<span class="sd">        Args:</span>
<span class="sd">            value: the value to be evaluated by the predicate. (object)</span>
<span class="sd">            predicate: an instance of predicate that will decided if the test passes (predicate)</span>
<span class="sd">            msg: a string describing what is checked by the assert. (str)</span>
<span class="sd">            expect: when True, the call will behave as an expect, and will skip the assert (boolean)</span>
<span class="sd">        Return:</span>
<span class="sd">            True if the assert was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">expect</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.clear_histories"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.clear_histories">[docs]</a>    <span class="k">def</span> <span class="nf">clear_histories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_stamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the IntegrationTestAPI&#39;s histories. Because the command history is not correlated to</span>
<span class="sd">        a flight software timestamp, it will be cleared entirely. This function can be used to set</span>
<span class="sd">        up test cases so that the IntegrationTestAPI&#39;s histories only contain objects received</span>
<span class="sd">        during that test.</span>
<span class="sd">        Note: this will not clear user-created sub-histories nor the aggregate histories (histories</span>
<span class="sd">        owned by the GDS)</span>

<span class="sd">        Args:</span>
<span class="sd">            time_stamp: If specified, histories are only cleared before the timestamp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">time_stamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">greater_than_or_equal_to</span><span class="p">(</span><span class="n">time_stamp</span><span class="p">)</span>
            <span class="n">e_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">event_predicate</span><span class="p">(</span><span class="n">time_pred</span><span class="o">=</span><span class="n">time_pred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">e_pred</span><span class="p">)</span>
            <span class="n">t_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">telemetry_predicate</span><span class="p">(</span><span class="n">time_pred</span><span class="o">=</span><span class="n">time_pred</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">t_pred</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Clearing Test Histories after </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_stamp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Clearing Test Histories&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">command_history</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.set_event_log_filter"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.set_event_log_filter">[docs]</a>    <span class="k">def</span> <span class="nf">set_event_log_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs an event predicate that is then used to filter which events are interlaced in the</span>
<span class="sd">        test logs. This method replaces the current filter. Calling this method with no arguments</span>
<span class="sd">        will effectively reset the filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: an optional mnemonic (str), id (int), or predicate to specify the event type</span>
<span class="sd">            args: an optional list of arguments (list of values, predicates, or None to ignore)</span>
<span class="sd">            severity: an EventSeverity enum or a predicate to specify the event severity</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_log_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   History Functions</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.get_command_test_history"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_command_test_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_command_test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accessor for IntegrationTestAPI&#39;s command history</span>
<span class="sd">        Returns:</span>
<span class="sd">            a history of CmdData objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_history</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_telemetry_test_history"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_telemetry_test_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_telemetry_test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accessor for IntegrationTestAPI&#39;s telemetry history</span>
<span class="sd">        Returns:</span>
<span class="sd">            a history of ChData objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_event_test_history"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_event_test_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accessor for IntegrationTestAPI&#39;s event history</span>
<span class="sd">        Returns:</span>
<span class="sd">            a history of EventData objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_telemetry_subhistory"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_telemetry_subhistory">[docs]</a>    <span class="k">def</span> <span class="nf">get_telemetry_subhistory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">telemetry_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fsw_order</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new instance of TestHistory that will be updated with new telemetry updates as</span>
<span class="sd">        they come in. Specifying a filter will only enqueue updates that satisfy the filter in this</span>
<span class="sd">        new sub-history. The returned history can be substituted into the await and assert methods</span>
<span class="sd">        of this API.</span>

<span class="sd">        Args:</span>
<span class="sd">            telemetry_filter: an optional predicate used to filter a subhistory.</span>
<span class="sd">            fsw_order: a flag to determine whether this subhistory will maintain FSW time order.</span>
<span class="sd">        Returns:</span>
<span class="sd">            an instance of TestHistory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fsw_order</span><span class="p">:</span>
            <span class="n">subhist</span> <span class="o">=</span> <span class="n">ChronologicalHistory</span><span class="p">(</span><span class="n">telemetry_filter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subhist</span> <span class="o">=</span> <span class="n">TestHistory</span><span class="p">(</span><span class="n">telemetry_filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_channel_consumer</span><span class="p">(</span><span class="n">subhist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subhist</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.remove_telemetry_subhistory"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.remove_telemetry_subhistory">[docs]</a>    <span class="k">def</span> <span class="nf">remove_telemetry_subhistory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subhist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        De-registers the subhistory from the GDS. Once called, the given subhistory will stop</span>
<span class="sd">        receiving telemetry updates.</span>

<span class="sd">        Args:</span>
<span class="sd">            subhist: a TestHistory instance that is subscribed to event messages</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the subhistory was removed, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">remove_channel_consumer</span><span class="p">(</span><span class="n">subhist</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_event_subhistory"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_event_subhistory">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_subhistory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fsw_order</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new instance of TestHistory that will be updated with new events as they come in.</span>
<span class="sd">        Specifying a filter will only enqueue events that satisfy the filter in this new</span>
<span class="sd">        sub-history. The returned history can be substituted into the await and assert methods of</span>
<span class="sd">        this API.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_filter: an optional predicate to filter a subhistory.</span>
<span class="sd">            fsw_order: a flag to determine whether this subhistory will maintain FSW time order.</span>
<span class="sd">        Returns:</span>
<span class="sd">            an instance of TestHistory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fsw_order</span><span class="p">:</span>
            <span class="n">subhist</span> <span class="o">=</span> <span class="n">ChronologicalHistory</span><span class="p">(</span><span class="n">event_filter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subhist</span> <span class="o">=</span> <span class="n">TestHistory</span><span class="p">(</span><span class="n">event_filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">register_event_consumer</span><span class="p">(</span><span class="n">subhist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subhist</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.remove_event_subhistory"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.remove_event_subhistory">[docs]</a>    <span class="k">def</span> <span class="nf">remove_event_subhistory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subhist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        De-registers the subhistory from the GDS. Once called, the given subhistory will stop</span>
<span class="sd">        receiving event messages.</span>

<span class="sd">        Args:</span>
<span class="sd">            subhist: a TestHistory instance that is subscribed to event messages</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the subhistory was removed, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">coders</span><span class="o">.</span><span class="n">remove_event_consumer</span><span class="p">(</span><span class="n">subhist</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Command Functions</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.translate_command_name"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.translate_command_name">[docs]</a>    <span class="k">def</span> <span class="nf">translate_command_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will translate the given mnemonic into an ID as defined by the flight</span>
<span class="sd">        software dictionary. This call will raise an error if the command given is not in the</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: Either the command id (int) or the command mnemonic (str)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The comand ID (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cmd_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">command_name</span>
            <span class="k">if</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">cmd_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cmd_dict</span><span class="p">[</span><span class="n">command</span><span class="p">]</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The command mnemonic, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">command</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">command_id</span>
            <span class="k">if</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">cmd_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">command</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The command id, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.send_command"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.send_command">[docs]</a>    <span class="k">def</span> <span class="nf">send_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the specified command.</span>
<span class="sd">        Args:</span>
<span class="sd">            command: the mnemonic (str) or ID (int) of the command to send</span>
<span class="sd">            args: a list of command arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Sending Command: </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">PURPLE</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_command_name</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.send_and_await_telemetry"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.send_and_await_telemetry">[docs]</a>    <span class="k">def</span> <span class="nf">send_and_await_telemetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the specified command and awaits the specified channel update or sequence of</span>
<span class="sd">        updates. See await_telemetry and await_telemetry_sequence for full details.</span>
<span class="sd">        Note: If awaiting a sequence avoid specifying timestamps.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: the mnemonic (str) or ID (int) of the command to send</span>
<span class="sd">            args: a list of command arguments.</span>
<span class="sd">            channels: a single or a sequence of channel specs (event_predicates, mnemonics, or IDs)</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The channel update or updates found by the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_telemetry_sequence</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_telemetry</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.send_and_await_event"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.send_and_await_event">[docs]</a>    <span class="k">def</span> <span class="nf">send_and_await_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the specified command and awaits the specified event message or sequence of</span>
<span class="sd">        messages. See await_event and await event sequence for full details.</span>
<span class="sd">        Note: If awaiting a sequence avoid specifying timestamps.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: the mnemonic (str) or ID (int) of the command to send</span>
<span class="sd">            args: a list of command arguments.</span>
<span class="sd">            events: a single or a sequence of event specifiers (event_predicates, mnemonics, or IDs)</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The event or events found by the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_event_sequence</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_event</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Command Asserts</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.send_and_assert_telemetry"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.send_and_assert_telemetry">[docs]</a>    <span class="k">def</span> <span class="nf">send_and_assert_telemetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the specified command and asserts on the specified channel update or sequence of</span>
<span class="sd">        updates. See await_telemetry and await_telemetry_sequence for full details.</span>
<span class="sd">        Note: If awaiting a sequence avoid specifying timestamps.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: the mnemonic (str) or ID (int) of the command to send</span>
<span class="sd">            args: a list of command arguments.</span>
<span class="sd">            channels: a single or a sequence of channel specs (event_predicates, mnemonics, or IDs)</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The channel update or updates found by the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">telemetry_history</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assert_telemetry_sequence</span><span class="p">(</span>
                <span class="n">channels</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assert_telemetry</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.send_and_assert_event"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.send_and_assert_event">[docs]</a>    <span class="k">def</span> <span class="nf">send_and_assert_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the specified command and asserts on the specified event message or sequence of</span>
<span class="sd">        messages. See assert_event and assert event sequence for full details.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: the mnemonic (str) or ID (int) of the command to send</span>
<span class="sd">            args: a list of command arguments.</span>
<span class="sd">            events: a single or a sequence of event specifiers (event_predicates, mnemonics, or IDs)</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The event or events found by the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_history</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assert_event_sequence</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assert_event</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Telemetry Functions</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.translate_telemetry_name"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.translate_telemetry_name">[docs]</a>    <span class="k">def</span> <span class="nf">translate_telemetry_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will translate the given mnemonic into an ID as defined by the flight</span>
<span class="sd">        software dictionary. This call will raise an error if the channel given is not in the</span>
<span class="sd">        dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel: a channel mnemonic (str) or id (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the channel ID (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ch_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">channel_name</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">ch_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ch_dict</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The telemetry mnemonic, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">channel</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ch_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">channel_id</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">ch_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">channel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The telemetry mnemonic, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">channel</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_telemetry_pred"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_telemetry_pred">[docs]</a>    <span class="k">def</span> <span class="nf">get_telemetry_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will translate the channel ID, and construct a telemetry_predicate object. It</span>
<span class="sd">        is used as a helper by the IntegrationTestAPI, but could also be helpful to a user of the</span>
<span class="sd">        test API. If  channel is already an instance of telemetry_predicate, it will be returned</span>
<span class="sd">        immediately. The provided implementation of telemetry_predicate evaluates true if and only</span>
<span class="sd">        if all specified constraints are satisfied. If a specific constraint isn&#39;t specified, then</span>
<span class="sd">        it will not effect the outcome; this means all arguments are optional. If no constraints</span>
<span class="sd">        are specified, the predicate will always return true.</span>


<span class="sd">        Args:</span>
<span class="sd">            channel: an optional mnemonic (str), id (int), or predicate to specify the channel type</span>
<span class="sd">            value: an optional value (object/number) or predicate to specify the value field</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">        Returns:</span>
<span class="sd">            an instance of telemetry_predicate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">predicates</span><span class="o">.</span><span class="n">telemetry_predicate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">channel</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_telemetry_name</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predicates</span><span class="o">.</span><span class="n">telemetry_predicate</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_telemetry"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_telemetry">[docs]</a>    <span class="k">def</span> <span class="nf">await_telemetry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search for a single telemetry update received. By default, the call will only await</span>
<span class="sd">        until a correct update is found. The user can specify that await also searches the current</span>
<span class="sd">        history by specifying a value for start. On timeout, the search will return None.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel: a channel specifier (mnemonic, id, or predicate)</span>
<span class="sd">            value: optional value (object/number) or predicate to specify the value field</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the ChData object found during the search, otherwise, None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_item</span><span class="p">(</span><span class="n">t_pred</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_telemetry_sequence"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_telemetry_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">await_telemetry_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search for a sequence of telemetry updates. By default, the call will only await until</span>
<span class="sd">        the sequence is completed. The user can specify that await also searches the history by</span>
<span class="sd">        specifying a value for start. On timeout, the search will return the list of found</span>
<span class="sd">        channel updates regardless of whether the sequence is complete.</span>
<span class="sd">        Note: It is recommended (but not enforced) not to specify timestamps for this assert.</span>
<span class="sd">        Note: This function will always return a list of updates. The user should check if the</span>
<span class="sd">        sequence was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            channels: an ordered list of channel specifiers (mnemonic, id, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            an ordered list of ChData objects that satisfies the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seq_preds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">seq_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_sequence</span><span class="p">(</span><span class="n">seq_preds</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_telemetry_count"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_telemetry_count">[docs]</a>    <span class="k">def</span> <span class="nf">await_telemetry_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search on the number of telemetry updates received. By default, the call will only await</span>
<span class="sd">        until a correct count is achieved. The user can specify that await also searches the current</span>
<span class="sd">        history by specifying a value for start. On timeout, the search will return the list of</span>
<span class="sd">        found channel updates regardless of whether a correct count is achieved.</span>
<span class="sd">        Note: this search will always return a list of objects. The user should check if the search</span>
<span class="sd">        was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            count: either an exact amount (int) or a predicate to specify how many objects to find</span>
<span class="sd">            channels: a channel specifier or list of channel specifiers (mnemonic, ID, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of the ChData objects that were counted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">channels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">t_preds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="n">t_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">))</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">satisfies_any</span><span class="p">(</span><span class="n">t_preds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_count</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Telemetry Asserts</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.assert_telemetry"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_telemetry">[docs]</a>    <span class="k">def</span> <span class="nf">assert_telemetry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An assert on a single telemetry update received. If the history doesn&#39;t have the</span>
<span class="sd">        correct update, the call will await until a correct update is received or the</span>
<span class="sd">        timeout, at which point it will assert failure.</span>

<span class="sd">        Args:</span>
<span class="sd">            channel: a channel specifier (mnemonic, id, or predicate)</span>
<span class="sd">            value: optional value (object/number) or predicate to specify the value field</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the ChData object found during the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_telemetry</span><span class="p">(</span>
            <span class="n">channel</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if item search found a correct update&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Telemetry received&quot;</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.assert_telemetry_sequence"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_telemetry_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">assert_telemetry_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search for a sing sequence of telemetry updates messages. If the history doesn&#39;t have the</span>
<span class="sd">        complete sequence, the call will await until the sequence is completed or the timeout, at</span>
<span class="sd">        which point it will return the list of found channel updates.</span>
<span class="sd">        Note: It is recommended (but not enforced) not to specify timestamps for this assert.</span>
<span class="sd">        Note: This function will always return a list of updates the user should check if the</span>
<span class="sd">        sequence was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            channels: an ordered list of channel specifiers (mnemonic, id, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            an ordered list of ChData objects that satisfies the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_telemetry_sequence</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">len_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if sequence search found every update&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Telemetry sequence&quot;</span><span class="p">,</span> <span class="n">len_pred</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.assert_telemetry_count"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_telemetry_count">[docs]</a>    <span class="k">def</span> <span class="nf">assert_telemetry_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An assert on the number of channel updates received. If the history doesn&#39;t have the</span>
<span class="sd">        correct update count, the call will await until a correct count is achieved or the</span>
<span class="sd">        timeout, at which point it will assert failure.</span>

<span class="sd">        Args:</span>
<span class="sd">            count: either an exact amount (int) or a predicate to specify how many objects to find</span>
<span class="sd">            channels: a channel specifier or list of channel specifiers (mnemonic, ID, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of the ChData objects that were counted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_telemetry_count</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">count_pred</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">count</span> <span class="k">if</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="k">else</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if count search found a correct amount of updates&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Telemetry count&quot;</span><span class="p">,</span> <span class="n">count_pred</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Event Functions</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.translate_event_name"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.translate_event_name">[docs]</a>    <span class="k">def</span> <span class="nf">translate_event_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will translate the given mnemonic into an ID as defined by the</span>
<span class="sd">        flight software dictionary. This call will raise an error if the event given is</span>
<span class="sd">        not in the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: an event mnemonic (str) or ID (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the event ID (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">event_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">event_name</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event_dict</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The event mnemonic, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">dictionaries</span><span class="o">.</span><span class="n">event_id</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">event_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The event id, </span><span class="si">{}</span><span class="s2">, wasn&#39;t in the dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.get_event_pred"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.get_event_pred">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will translate the event ID, and construct an event_predicate object. It is</span>
<span class="sd">        used as a helper by the IntegrationTestAPI, but could also be helpful to a user of the test</span>
<span class="sd">        API. If event is already an instance of event_predicate, it will be returned immediately.</span>
<span class="sd">        The provided implementation of event_predicate evaluates true if and only if all specified</span>
<span class="sd">        constraints are satisfied. If a specific constraint isn&#39;t specified, then it will not</span>
<span class="sd">        effect the outcome; this means all arguments are optional. If no constraints are specified,</span>
<span class="sd">        the predicate will always return true.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: mnemonic (str), id (int), or predicate to specify the event type</span>
<span class="sd">            args: list of arguments (list of values, predicates, or None to ignore)</span>
<span class="sd">            severity: an EventSeverity enum or a predicate to specify the event severity</span>
<span class="sd">            time_pred: predicate to specify the flight software timestamp</span>
<span class="sd">        Returns:</span>
<span class="sd">            an instance of event_predicate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">predicates</span><span class="o">.</span><span class="n">event_predicate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">event</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_event_name</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">args_predicate</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">severity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="n">EventSeverity</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Given severity was not a valid Severity Enum Value: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">severity</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">severity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predicates</span><span class="o">.</span><span class="n">event_predicate</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_event"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_event">[docs]</a>    <span class="k">def</span> <span class="nf">await_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search for a single event message received. By default, the call will only await until a</span>
<span class="sd">        correct message is found. The user can specify that await also searches the current history</span>
<span class="sd">        by specifying a value for start. On timeout, the search will return None.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: an event specifier (mnemonic, id, or predicate)</span>
<span class="sd">            args: a list of expected arguments (list of values, predicates, or None for don&#39;t care)</span>
<span class="sd">            severity: an EventSeverity enum or a predicate to specify the event severity</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the EventData object found during the search, otherwise, None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">e_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_item</span><span class="p">(</span><span class="n">e_pred</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_event_sequence"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_event_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">await_event_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search for a sequence of event messages. By default, the call will only await until</span>
<span class="sd">        the sequence is completed. The user can specify that await also searches the history by</span>
<span class="sd">        specifying a value for start. On timeout, the search will return the list of found</span>
<span class="sd">        event messages regardless of whether the sequence is complete.</span>
<span class="sd">        Note: It is recommended (but not enforced) not to specify timestamps for this assert.</span>
<span class="sd">        Note: This function will always return a list of events the user should check if the</span>
<span class="sd">        sequence was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            events: an ordered list of event specifiers (mnemonic, id, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            an ordered list of EventData objects that satisfies the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seq_preds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">seq_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_sequence</span><span class="p">(</span><span class="n">seq_preds</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.await_event_count"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.await_event_count">[docs]</a>    <span class="k">def</span> <span class="nf">await_event_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;NOW&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A search on the number of events received. By default, the call will only await until a</span>
<span class="sd">        correct count is achieved. The user can specify that this await also searches the current</span>
<span class="sd">        history by specifying a value for start. On timeout, the search will return the list of</span>
<span class="sd">        found event messages regardless of whether a correct count is achieved.</span>
<span class="sd">        Note: this search will always return a list of objects. The user should check if the search</span>
<span class="sd">        was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            count: either an exact amount (int) or a predicate to specify how many objects to find</span>
<span class="sd">            events: an event specifier or list of event specifiers (mnemonic, ID, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of the EventData objects that were counted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">e_preds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                <span class="n">e_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">))</span>
            <span class="n">search</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">satisfies_any</span><span class="p">(</span><span class="n">e_preds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">events</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_test_history</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_history_count</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   Event Asserts</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.assert_event"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_event">[docs]</a>    <span class="k">def</span> <span class="nf">assert_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">severity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An assert on a single event message received. If the history doesn&#39;t have the</span>
<span class="sd">        correct message, the call will await until a correct message is received or the</span>
<span class="sd">        timeout, at which point it will assert failure.</span>

<span class="sd">        Args:</span>
<span class="sd">            event: an event specifier (mnemonic, id, or predicate)</span>
<span class="sd">            args: a list of expected arguments (list of values, predicates, or None for don&#39;t care)</span>
<span class="sd">            severity: an EventSeverity enum or a predicate to specify the event severity</span>
<span class="sd">            time_pred: an optional predicate to specify the flight software timestamp</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the EventData object found during the search</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_event</span><span class="p">(</span>
            <span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if item search found a correct event&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Event received&quot;</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.assert_event_sequence"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_event_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">assert_event_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An assert that a sequence of event messages is received. If the history doesn&#39;t have the</span>
<span class="sd">        complete sequence, the call will await until the sequence is completed or the timeout, at</span>
<span class="sd">        which point it will assert failure.</span>
<span class="sd">        Note: It is recommended (but not enforced) not to specify timestamps for this assert.</span>

<span class="sd">        Args:</span>
<span class="sd">            events: an ordered list of event specifiers (mnemonic, id, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            an ordered list of EventData objects that satisfied the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_event_sequence</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">len_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if sequence search found every event&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Event sequence&quot;</span><span class="p">,</span> <span class="n">len_pred</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.assert_event_count"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.assert_event_count">[docs]</a>    <span class="k">def</span> <span class="nf">assert_event_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An assert on the number of events received. If the history doesn&#39;t have the</span>
<span class="sd">        correct event count, the call will await until a correct count is achieved or the</span>
<span class="sd">        timeout, at which point it will assert failure.</span>

<span class="sd">        Args:</span>
<span class="sd">            count: either an exact amount (int) or a predicate to specify how many objects to find</span>
<span class="sd">            events: optional event specifier or list of specifiers (mnemonic, id, or predicate)</span>
<span class="sd">            history: if given, a substitute history that the function will search and await</span>
<span class="sd">            start: an optional index or predicate to specify the earliest item to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of the EventData objects that were counted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_event_count</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="n">count_pred</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">count</span> <span class="k">if</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="k">else</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;checks if count search found a correct amount of events&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__assert_pred</span><span class="p">(</span><span class="s2">&quot;Event count&quot;</span><span class="p">,</span> <span class="n">count_pred</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   History Searches</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.__HistorySearcher"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__HistorySearcher">[docs]</a>    <span class="k">class</span> <span class="nc">__HistorySearcher</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class defines the calls made by the __history_search helper method and has a unique</span>
<span class="sd">        implementation for each type of search provided by the api.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="IntegrationTestAPI.__HistorySearcher.search_current_history"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__HistorySearcher.search_current_history">[docs]</a>        <span class="k">def</span> <span class="nf">search_current_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Searches the scoped existing history</span>
<span class="sd">            Return:</span>
<span class="sd">                True if the search was satisfied, False otherwise</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.__HistorySearcher.incremental_search"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__HistorySearcher.incremental_search">[docs]</a>        <span class="k">def</span> <span class="nf">incremental_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Searches one awaited item at a time</span>
<span class="sd">            Return:</span>
<span class="sd">                True if the search was satisfied, False otherwise</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.__HistorySearcher.get_return_value"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__HistorySearcher.get_return_value">[docs]</a>        <span class="k">def</span> <span class="nf">get_return_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns the result of the search whether the search is successful or not</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.__HistorySearcher.requires_repeats"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__HistorySearcher.requires_repeats">[docs]</a>        <span class="k">def</span> <span class="nf">requires_repeats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns a flag to determine if the history searcher needs repeated data objects when receive order does not match chronological order.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span></div></div>

    <span class="k">class</span> <span class="nc">TimeoutException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This exception is used by the history searches to signal the end of the timeout.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IntegrationTestAPI.__timeout_sig_handler"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__timeout_sig_handler">[docs]</a>    <span class="k">def</span> <span class="nf">__timeout_sig_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.__search_test_history"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__search_test_history">[docs]</a>    <span class="k">def</span> <span class="nf">__search_test_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searcher</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This helper method contains the common logic to all search methods in the test API. This</span>
<span class="sd">        means searches on both the event and channel histories rely on this helper. Each history</span>
<span class="sd">        search is performed on both current history items and then on items that have yet to be</span>
<span class="sd">        added to the history. The API defines these two scopes using the variables start and</span>
<span class="sd">        timeout. They have several useful behaviors.</span>

<span class="sd">        start is used to pick the earliest item to search in the current history. start can be</span>
<span class="sd">        specified as either a predicate to search for the first item, an index of the history, the</span>
<span class="sd">        API variable NOW, or an instance of the TimeType timestamp object. The behavior of NOW is</span>
<span class="sd">        to ignore the current history and only search awaited items until the timestamp. The</span>
<span class="sd">        behavior of giving a timetype is to only search items that happened at or after the</span>
<span class="sd">        specified timestamp.</span>

<span class="sd">        timeout is a specification of how long to await future items in seconds. Specifying a</span>
<span class="sd">        timeout of 0 will ignore all future items. The timeout specifies an increment of time</span>
<span class="sd">        relative to the local clock, not the embedded application&#39;s clock.</span>
<span class="sd">        Note: the API does not try to check for edge cases where the final item in a search is</span>
<span class="sd">        received as the search times out. The user should ensure that their timeouts are sufficient</span>
<span class="sd">        to complete any awaiting searches.</span>

<span class="sd">        Finally, the test API supports the ability to substitute a history object for any search.</span>
<span class="sd">        This is part of why history must be specified for each search</span>

<span class="sd">        Args:</span>
<span class="sd">            searcher: an instance of __HistorySearcher to execute search-specific logic</span>
<span class="sd">            name: a string name to differentiate the type of search</span>
<span class="sd">            history: the TestHistory object to conduct the search on</span>
<span class="sd">            start: an index, a predicate, the NOW variable, or a TimeType timestamp to pick the</span>
<span class="sd">                first item to search</span>
<span class="sd">            timeout: the number of seconds to await future items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOW</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">TimeType</span><span class="p">):</span>
            <span class="n">time_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">greater_than_or_equal_to</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">e_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_telemetry_pred</span><span class="p">(</span><span class="n">time_pred</span><span class="o">=</span><span class="n">time_pred</span><span class="p">)</span>
            <span class="n">t_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_event_pred</span><span class="p">(</span><span class="n">time_pred</span><span class="o">=</span><span class="n">time_pred</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">satisfies_any</span><span class="p">([</span><span class="n">e_pred</span><span class="p">,</span> <span class="n">t_pred</span><span class="p">])</span>

        <span class="n">current</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">searcher</span><span class="o">.</span><span class="n">search_current_history</span><span class="p">(</span><span class="n">current</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_return_value</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; now awaiting for at most </span><span class="si">{}</span><span class="s2"> s.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
            <span class="n">check_repeats</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">ChronologicalHistory</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timeout_sig_handler</span><span class="p">)</span>
                <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">check_repeats</span><span class="p">:</span>
                        <span class="n">new_items</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">retrieve_new</span><span class="p">(</span><span class="n">searcher</span><span class="o">.</span><span class="n">requires_repeats</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_items</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">retrieve_new</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">new_items</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">searcher</span><span class="o">.</span><span class="n">incremental_search</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_return_value</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span>
                    <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; timed out and ended unsuccessfully.&quot;</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span>
                <span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; ended unsuccessfully.&quot;</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">searcher</span><span class="o">.</span><span class="n">get_return_value</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.find_history_item"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.find_history_item">[docs]</a>    <span class="k">def</span> <span class="nf">find_history_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_pred</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function can both search and await for an element in a history. The function will</span>
<span class="sd">        return the first valid object it finds. The search will return when an object is found, or</span>
<span class="sd">        the timeout is reached.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_pred: a predicate to specify a history item.</span>
<span class="sd">            history: the history that the function will search and await</span>
<span class="sd">            start: an index or predicate to specify the earliest item from the history to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            the data object found during the search, otherwise, None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">__ItemSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__HistorySearcher</span><span class="p">):</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">search_pred</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span> <span class="o">=</span> <span class="n">search_pred</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Beginning an item search for an item that satisfies:</span><span class="se">\n</span><span class="s2">    </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">search_current_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental_search</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">incremental_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;History search found the specified item: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="n">item</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="n">searcher</span> <span class="o">=</span> <span class="n">__ItemSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">,</span> <span class="n">search_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__search_test_history</span><span class="p">(</span>
            <span class="n">searcher</span><span class="p">,</span> <span class="s2">&quot;Item search&quot;</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="IntegrationTestAPI.find_history_sequence"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.find_history_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">find_history_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq_preds</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function can both search and await for a sequence of elements in a history. The</span>
<span class="sd">        function will return a list of the history objects to satisfy the sequence search. The</span>
<span class="sd">        search will return when an order of data objects is found that satisfies the entire</span>
<span class="sd">        sequence, or the timeout occurs.</span>
<span class="sd">        Note: this search will always return a list of objects. The user should check if the search</span>
<span class="sd">        was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            seq_preds: an ordered list of predicate objects to specify a sequence</span>
<span class="sd">            history: the history that the function will search and await</span>
<span class="sd">            start: an index or predicate to specify the earliest item from the history to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of data objects that satisfied the sequence</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">__SequenceSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__HistorySearcher</span><span class="p">):</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">seq_preds</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span> <span class="o">=</span> <span class="n">seq_preds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Beginning a sequence search of </span><span class="si">{}</span><span class="s2"> items.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">search_current_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Sequence search finished, as the specified sequence had 0 items.&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>

                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental_search</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">incremental_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">item</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Sequence search found the next item: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq_preds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="s2">&quot;Sequence search found the last item.&quot;</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="n">searcher</span> <span class="o">=</span> <span class="n">__SequenceSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">,</span> <span class="n">seq_preds</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__search_test_history</span><span class="p">(</span>
            <span class="n">searcher</span><span class="p">,</span> <span class="s2">&quot;Sequence search&quot;</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="IntegrationTestAPI.find_history_count"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.find_history_count">[docs]</a>    <span class="k">def</span> <span class="nf">find_history_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">search_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function first counts all valid items in the current history, then can await until a</span>
<span class="sd">        valid number of elements is received by the history. The function will return a list of the</span>
<span class="sd">        history objects counted by the search. The search will return when a correct count of data</span>
<span class="sd">        objects is found, or the timeout occurs.</span>
<span class="sd">        Note: this search will always return a list of objects. The user should check if the search</span>
<span class="sd">        was completed.</span>

<span class="sd">        Args:</span>
<span class="sd">            count: either an exact amount (int) or a predicate to specify how many objects to find</span>
<span class="sd">            history: the history that the function will search and await</span>
<span class="sd">            search_pred: a predicate to specify which items to count. If left blank, all will count</span>
<span class="sd">            start: an index or predicate to specify the earliest item from the history to search</span>
<span class="sd">            timeout: the number of seconds to wait before terminating the search (int)</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of data objects that were counted during the search</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">class</span> <span class="nc">__CountSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__HistorySearcher</span><span class="p">):</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">search_pred</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">predicates</span><span class="o">.</span><span class="n">is_predicate</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_pred</span> <span class="o">=</span> <span class="n">count</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span> <span class="o">=</span> <span class="n">search_pred</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Beginning a count search for an amount of items (</span><span class="si">{}</span><span class="s2">).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">count_pred</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">search_current_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">always_true</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span> <span class="o">=</span> <span class="n">items</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">search_pred</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                                <span class="s2">&quot;Count search counted another item: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_pred</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="p">)):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Count search found a correct amount: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">incremental_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pred</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Count search counted another item: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_pred</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="p">)):</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Count search found a correct amount: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_val</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">YELLOW</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="n">searcher</span> <span class="o">=</span> <span class="n">__CountSearcher</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">search_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__search_test_history</span><span class="p">(</span>
            <span class="n">searcher</span><span class="p">,</span> <span class="s2">&quot;Count search&quot;</span><span class="p">,</span> <span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">timeout</span></div>
        <span class="p">)</span>

    <span class="c1">######################################################################################</span>
    <span class="c1">#   API Helper Methods</span>
    <span class="c1">######################################################################################</span>
<div class="viewcode-block" id="IntegrationTestAPI.__log"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__log">[docs]</a>    <span class="k">def</span> <span class="nf">__log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;Test API&quot;</span><span class="p">,</span> <span class="n">case_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs and prints an API Message. If the API isn&#39;t using a Logger, then only a message will</span>
<span class="sd">        be printed.</span>
<span class="sd">        Args:</span>
<span class="sd">            message: a string containing the message to log</span>
<span class="sd">            color: a color hex code (str)</span>
<span class="sd">            style: a style option from test logger (str) [&quot;BOLD&quot;, &quot;ITALICS&quot;, &quot;UNDERLINED&quot;]</span>
<span class="sd">            sender: a marker for where the message originated</span>
<span class="sd">            case_id: a tag for the current test case. Only needs to be set when a new case starts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">case_id</span><span class="p">)</span></div>
        <span class="c1"># TODO: Re-add way of printing to console?</span>

<div class="viewcode-block" id="IntegrationTestAPI.__assert_pred"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.__assert_pred">[docs]</a>    <span class="k">def</span> <span class="nf">__assert_pred</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to assert that a value satisfies a predicate. Includes arguments to provide more</span>
<span class="sd">        descriptive messages in the logs.</span>
<span class="sd">        Args:</span>
<span class="sd">            name: short name describing the check</span>
<span class="sd">            predicate: an instance of predicate to determine if the assert is successful</span>
<span class="sd">            value: the object evaluated by the predicate</span>
<span class="sd">            msg: a string message to describe what the assert is checking</span>
<span class="sd">            expect: a boolean value: True will be have as an expect and not raise an assertion.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the assertion was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; expectation&quot;</span> <span class="k">if</span> <span class="n">expect</span> <span class="k">else</span> <span class="s2">&quot; assertion&quot;</span><span class="p">)</span>
        <span class="n">pred_msg</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">get_descriptive_string</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">predicate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; succeeded: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">assert &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="n">pred_msg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">ast_msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expect</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pred_msg</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ast_msg</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; failed: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">assert &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="n">pred_msg</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expect</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">ast_msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pred_msg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">ast_msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">ORANGE</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="IntegrationTestAPI.data_callback"><a class="viewcode-back" href="../../../../api/fprime_gds/common/testing_fw/api/index.html#fprime_gds.common.testing_fw.api.IntegrationTestAPI.data_callback">[docs]</a>    <span class="k">def</span> <span class="nf">data_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data callback used by the api to log events and detect when they are received out of order.</span>
<span class="sd">        Args:</span>
<span class="sd">            data: object to store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_log_filter</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Received EVR: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">BLUE</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;GDS&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_evr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_evr</span><span class="o">.</span><span class="n">get_time</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;API detected out of order evrs!&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Received First:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_evr</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Received Second:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">TestLogger</span><span class="o">.</span><span class="n">ORANGE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_evr</span> <span class="o">=</span> <span class="n">data</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Michael Starch

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
