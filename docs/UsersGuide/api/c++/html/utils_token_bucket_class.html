<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Utils::TokenBucket Class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">Latest</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_utils_token_bucket_class.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_utils_1_1_token_bucket.html">Utils::TokenBucket</a> Class </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md693"></a>
Utils::TokenBucket</h1>
<h2><a class="anchor" id="autotoc_md694"></a>
1 Introduction</h2>
<p><code>TokenBucket</code> is a pure utility class used for throttling actions, such as components that want to throttle events.</p>
<p>It is similar to <code>RateLimiter</code>, but supports a different throttling behavior, specifically time-based throughput throttling with burstiness. For instance, <code>TokenBucket</code> allows a burst of 5 triggers, before throttling them to 1 trigger per second after. Unused triggers are collected up to the burst maximum.</p>
<h2><a class="anchor" id="autotoc_md695"></a>
2 Usage</h2>
<h3><a class="anchor" id="autotoc_md696"></a>
2.1 Basic</h3>
<p>TokenBucket is a class that can be included and instantiated with the initial replenish interval and max tokens.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="token_bucket_8hpp.html">Utils/TokenBucket.hpp</a>&gt;</span></div>
<div class="line">...</div>
<div class="line">U32 replenishIntervalMicroSecs = 1000000;</div>
<div class="line">U32 maxTokens = 5;</div>
<div class="line">TokenBucket bucket(replenishIntervalMicroSecs, maxTokens);</div>
<div class="ttc" id="a_token_bucket_8hpp_html"><div class="ttname"><a href="token_bucket_8hpp.html">TokenBucket.hpp</a></div></div>
</div><!-- fragment --><p>This instantiates <code>TokenBucket</code> with 5 initial tokens out of 5 maximum. Updating and testing if an action should trigger is done in one method:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (bucket.trigger(this-&gt;getTime())) {</div>
<div class="line">  <span class="comment">// perform action, e.g. log EVR</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Your component must provide it the current <code><a class="el" href="class_fw_1_1_time.html">Fw::Time</a></code> in the trigger. It will then use that time to evaluate how many tokens to replenish between the last trigger and now, and evaluate whether a token can be consumed.</p>
<p>With 5 initial tokens, the first five triggers are guaranteed to return true, no matter what the time given is. After that, trigger will return true only if time has elapsed enough for a token to be replenished (in this example, once per second).</p>
<p>Note that the max tokens is capped at 1000, currently defined as <code>MAX_TOKEN_BUCKET_TOKENS</code> in <a class="el" href="token_bucket_8hpp.html">TokenBucket.hpp</a>.</p>
<h3><a class="anchor" id="autotoc_md697"></a>
2.2 Advanced</h3>
<p><code>TokenBucket</code> can be constructed with 3 more parameters:</p>
<div class="fragment"><div class="line">U32 replenishIntervalMicroSecs = 1000000;</div>
<div class="line">U32 maxTokens = 5;</div>
<div class="line">U32 replenishRate = 2;</div>
<div class="line">U32 startTokens = 2;</div>
<div class="line"><a class="code" href="class_fw_1_1_time.html">Fw::Time</a> startTime(5, 0);</div>
<div class="line">TokenBucket bucket(replenishIntervalMicroSecs, maxTokens, replenishRate, startTokens, startTime);</div>
<div class="ttc" id="aclass_fw_1_1_time_html"><div class="ttname"><a href="class_fw_1_1_time.html">Fw::Time</a></div><div class="ttdef"><b>Definition:</b> <a href="time_8hpp_source.html#l00009">Time.hpp:9</a></div></div>
</div><!-- fragment --><ul>
<li>Replenish rate is the number of tokens to increment by per interval. By default, this is 1.</li>
<li>Start tokens is the number of tokens to start with. Note that the first trigger will nonetheless attempt to replenish tokens from the start time until the given time, so it is best used with the start time parameter. By default, start tokens is max tokens, and start time is 0. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="utils.html">Utils Classes</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
