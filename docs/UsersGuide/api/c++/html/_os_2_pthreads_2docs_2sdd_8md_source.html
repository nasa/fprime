<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Os/Pthreads/docs/sdd.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">NASA-v1.6.0</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_os_2_pthreads_2docs_2sdd_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Os/Pthreads/docs/sdd.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_os_2_pthreads_2docs_2sdd_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;\page OsQueue Os::Queue (Pthreads implementation)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# Os::Queue (Pthreads implementation)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;## 1 Introduction</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The ISF `Os::Queue` provides a message queue interface for asynchronous ISF ports. Many operating systems provide</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;their own inter-process communication (IPC) queues (ie. [POSIX](http://man7.org/linux/man-pages/man7/mq_overview.7.html), VxWorks, [SysV](http://man7.org/linux/man-pages/man7/svipc.7.html)), which have traditionally been used as</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;the underlying implementation for `Os::Queue`. In contrast, this Pthreads implementation is hand coded C++ code</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;tailored to the ISF `Os::Queue` interface. Its only dependency on non-standard libraries is [`&lt;pthread.h&gt;`](http://pubs.opengroup.org/onlinepubs/007908799/xsh/pthread.h.html), which is </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;used for access and control flow of the internal queue data structure (ie. [`pthread_mutex_lock`](http://pubs.opengroup.org/onlinepubs/007908799/xsh/pthread_mutex_lock.html), [`pthread_cond_wait`](http://pubs.opengroup.org/onlinepubs/007908799/xsh/pthread_cond_wait.html), </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;etc.). The Pthread implementation provides the following advantages over the operating system provided IPC queues:</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;- The Pthreads implementation is NOT an IPC queue. It is designed for message passing between threads in the same</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;memory address space. This means that it never touches the filesystem and has no persistent state after the</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;`Os::Queue` deconstructor has been called. ISF currently does not spread different threads of execution in different memory </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;spaces on Darwin and Linux, so this is an acceptable solution.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;- Memory for Pthreads queues are allocated on the heap at initialization. After initialization, the memory usage of the</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;queue remains static. The queue sizes are only limited by the amount of memory on your system. The queue size is NOT </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;governed by arbitrary limits defined in kernel configurations, as is the case for POSIX and SysV queues.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;- Since the Pthreads implementation is handwritten, ISF developers can change the interface and add new features</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;to support mission needs. In particular, queue usage statistics can be built in, such as high water marking, message</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;counts, etc.</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;The Pthread queues can be configured in one of two ways depending on mission needs: first-in-first-out (FIFO) or priority. </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The FIFO queue is implemented using a circular buffer with *O(log(1))* enqueue and dequeue time. The priority queue is</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;implemented using a stable maximum binary heap with *O(log(n))* enqueue and dequeue time. Note: A *stable* maximum binary heap </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;has the property that items pulled off the queue are in order of decreasing priority. Items of equal priority are pulled off </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;in FIFO order.</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;NOTE: [POSIX queues](https://elixir.bootlin.com/linux/latest/source/ipc/mqueue.c) use a dynamically sized [red-black tree](https://en.wikipedia.org/wiki/Red%E2%80%93black_tree) for the message queue data structure. This data structure also has an *O(log(n))* enqueue and dequeue time.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;## 2 Requirements</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;Requirement | Description | Rationale | Verification Method</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;---- | ---- | ---- | ----</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;ISF-Q-001 | The Pthreads queue shall conform to the ISF `Os::Queue` interface. | Ensures the queue can be used for ISF components | Inspection</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;ISF-Q-002 | The Pthreads queue shall not use dynamic memory, except at initialization. | Conform to flight software guidelines. | Inspection</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;ISF-Q-003 | The Pthreads queue shall not use operating system parameters for size limits. | Ensure that the queue sizes can be changed by the user without changing kernel parameters. | Inspection</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;## 3 Design</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;### 3.1 Constants</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;The Pthreads queue uses the following constants, specified at instantiation:</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;1. &lt;a name=&quot;msgSize&quot;&gt;*Message Size*&lt;/a&gt;: The maximum size of a message that can be stored in the queue.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;2. &lt;a name=&quot;depth&quot;&gt;*Depth*&lt;/a&gt;: The maximum number of messages that can stored in the queue.</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;3. &lt;a name=&quot;block&quot;&gt;*Block*&lt;/a&gt;: Flag which specifies whether the queue should block when reading from an empty queue.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;### 3.2 State</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;The queue maintains the following state:</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;1. &lt;a name=&quot;num_queue&quot;&gt;*Number of Queues*&lt;/a&gt;: The current number of queues allocated in the system (static variable which starts at 0).</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;2. &lt;a name=&quot;count&quot;&gt;*Count*&lt;/a&gt;: The current number of messages in the queue (starts at 0).</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;3. &lt;a name=&quot;maxCount&quot;&gt;*Maximum Count*&lt;/a&gt;: The maximum number of messages ever seen in the queue since instantiation. This the a &quot;high water mark&quot; of the queue.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;4. &lt;a name=&quot;queue&quot;&gt;*Queue*&lt;/a&gt;: The queue data structure itself. The queue memory is allocated in a `U8*` buffer of size: ([Message Size](#msgSize) + `sizeof(NATIVE_UINT_TYPE)`) * [Depth](#depth)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;5. &lt;a name=&quot;heap&quot;&gt;*Heap*&lt;/a&gt; (for priority queue only): The stable maximum binary heap data structure which orders stored messages with respect to priority. The size of the heap in memory is: `sizeof(NATIVE_UINT_TYPE)` * 3 * [Depth](#depth).</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;### 3.3 Stable Maximum Binary Heap</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;A maximum [binary heap data structure](https://en.wikipedia.org/wiki/Binary_heap) is a binary tree with the following constraints:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;1. It is complete, that is, all levels of the tree, except possibly the last one (deepest) are fully filled, and, if the last level of the tree is not complete, the nodes of that level are filled from left to right.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;2. It satisfies the maximum heap property, that is, all nodes are either greater than or equal to each of its children.</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;The Pthreads heap implementation is also *stable*, which means it satisfies the following additional constraint:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;3. If a node has children nodes of equal value, the parent node must be &quot;older&quot; (inserted before) each equal-valued child node. </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;This ensures that messages of equal priority are dequeued in FIFO order.</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;##4 Implementation</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;This section provides a summary of the code included in the C++ implementation files.</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;- **`Queue.cpp`:** This is the implementation of the ISF `Os::Queue` class. This file provides synchronization between threads reading and writing to the queue, and passes data to and from the underlying data structure.</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;- **`BufferQueue.hpp`:** This file outlines an interface to a generic queue data structure.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;- **`FIFOBufferQueue.cpp`:** This file implements a first-in-first-out queue data structure, conforming to `BufferQueue.hpp`.</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;- **`PriorityBufferQueue.cpp`:** This file implements a priority queue data structure, conforming to `BufferQueue.hpp`. It uses files in MaxHeap/ to perform priority queueing.</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;- **`BufferQueueCommon.cpp`:** This file implements various common methods for `BufferQueue.hpp`.</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;- **`MaxHeap/MaxHeap.hpp`:** This file outlines an interface to a generic maximum heap data structure, where `NATIVE_INT_TYPE` is used for priority and a `NATIVE_UINT_TYPE` is stored as data.</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;- **`MaxHeap/MaxHeap.cpp`:** This file implements a stable maximum heap conforming to `MaxHeap/MaxHeap.hpp`.</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;Note: To use the FIFO queue implementation, a user must include `Queue.cpp`, `FIFOBufferQueue.cpp`, and `BufferQueueCommon.cpp` in the compilation. To use the priority queue implementation, the user must include `Queue.cpp`, `PriorityBufferQueue.cpp`, `BufferQueueCommon.cpp`, and `MaxHeap/MaxHeap.cpp`.</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;## 5 Unit Testing</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;There are 3 unit tests used to validate the Pthreads queue implementation at different levels of abstraction.</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;### 5.1 Maximum Heap Unit Test</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;The maximum heap unit tests are located in `Os/Pthread/MaxHeap/test/ut`. These tests validate the functionality of the maximum heap data structure. Test names and descriptions are listed below:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;1. **Empty Heap**: Make sure that removing an item from an empty heap returns an error.</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;2. **Full Heap**: Make sure that adding an item to a full heap returns an error.</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;3. **Pop**: Test removing an item from a filled heap.</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;4. **Random Push/Pop**: Test adding and removing items of varied priority and ensure that they are returned off the heap in the correct order.</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;5. **Equal Priority**: Test that items added to the queue with equal priority are popped off in FIFO order.</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;6. **Mixed Priority**: Test that items added to the queue with both varied and equal priority are popped off in priority order and FIFO order when priorities are equal.</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;### 5.2 Buffer Queue Unit Test</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;The buffer queue unit tests are located in `Os/Pthread/test/ut`. These tests validate the functionality of the underlying queue data structure. Note: These tests do NOT test any blocking behavior of the queue. Test names and descriptions are listed below:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;1. **Empty Queue**: Make sure that removing an item from an empty queue returns an error.</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;2. **Full Queue**: Make sure that adding an item to a full queue returns an error.</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;3. **Size Mismatch**: Make sure that trying to receive a large message into a too-small buffer returns an error.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;4. **Pop**: Test removing an item from a filled queue.</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;5. **Priorities**: Ensure that the queue returns messages in priority order, and in FIFO order for equal priorities.</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;### 5.3 Queue Unit Test</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;The queue unit tests are located in `Os/test/ut`. These tests validate the functionality of the queue as well as the blocking behavior at the component interface level. Test names and descriptions are listed below:</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;#### 5.3.1 Blocking Queue Unit Test</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;1. **Send and Receive**: Test successful send and receive from a blocking queue.</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;2. **Blocking Receive on Empty**: Test blocking behavior for receiving on an empty queue.</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;3. **Non-blocking Send on Full**: Test non-blocking behavior for sending to a full queue.</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;4. **Send and Receive with Priorities**: Test that sending and receiving of messages occurs in the correct order with respect to priority.</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;#### 5.3.2 Non-blocking Queue Unit Test</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;1. **Send and Receive**: Test successful send and receive from a non-blocking queue.</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;2. **Non-blocking Receive on Empty**: Test non-blocking behavior for receiving on an empty queue.</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;3. **Non-blocking Send on Full**: Test non-blocking behavior for sending to a full queue.</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;4. **Send and Receive with Priorities**: Test that sending and receiving of messages occurs in the correct order with respect to priority.</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;#### 5.3.3 Queue Performance Unit Test</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;1. **Shallow Queue Test**: 3 messages are sent on the queue, and then 3 messages are read on the queue. This test is repeated 1000000 times in a single thread and the execution time is printed.</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;2. **Deep Queue Test**: The queue is first pre-filled to its maximum capacity (default 10). Next, test 1 is run 1000000 times and the execution time is printed.</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;3. **Concurrent Queue Test**: Test 2 is run simultaneously using 4 threads, 50000 times for each thread, and the execution time is printed.</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;## 6 Performance</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;The performance results for tests 5.3.3 for the Pthreads queue and the Posix queue were run on a Virtual Box VM (hosted on a Mac) and given 4 execution cores (April 2016). The test results can be seen below:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;**Pthreads queue results:**</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;```</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;---------------------</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;- performance test --</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;---------------------</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;Testing shallow queue...</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;Time: 1.362s (1.362us per)</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;Testing deep queue...</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;Time: 1.769s (1.769us per)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;Test complete.</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;---------------------</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;---------------------</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;---------------------</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;-- concurrent test --</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;---------------------</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;Testing deep queue...</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;Time: 0.882s (17.633us per)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;Test complete.</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;---------------------</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;---------------------</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;```</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;**Posix queue results:**</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;```</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;---------------------</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;- performance test --</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;---------------------</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;Testing shallow queue...</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;Time: 3.993s (3.993us per)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;Testing deep queue...</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;Time: 3.942s (3.942us per)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;Test complete.</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;---------------------</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;---------------------</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;---------------------</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;-- concurrent test --</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;---------------------</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;Testing deep queue...</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;Time: 0.701s (14.017us per)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;Test complete.</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;---------------------</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;---------------------</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;```</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;The Pthreads queues are significantly faster than posix queues on a single core. The Pthreads queue is marginally slower in a multi-threaded environment, but its performance is still very similar to the Posix queue implementation. Based on these results the the Pthreads queue is performant enough for single core flight systems. It also looks to have reasonable performance when multi-threaded. If we wanted better multi-core performance, we could look into implementing a [lock-free concurrent max heap data structure](http://www.non-blocking.com/download/SunT03_PQueue_TR.pdf).</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_os_2_pthreads_2docs_2sdd_8md.html">sdd.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
