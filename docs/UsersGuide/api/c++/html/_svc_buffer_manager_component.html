<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Svc::BufferManager Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">NASA-v1.5.0</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_svc_buffer_manager_component.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_svc_1_1_buffer_manager.html">Svc::BufferManager</a> Component </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md176"></a>
Svc::BufferManager</h1>
<h2><a class="anchor" id="autotoc_md177"></a>
1 Introduction</h2>
<p><code>BufferManager</code> is a passive ISF component. It allocates and deallocates variable-sized buffers from a fixed-size store.</p>
<h2><a class="anchor" id="autotoc_md178"></a>
2 Requirements</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Requirement  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Rationale  </th><th class="markdownTableHeadNone">Verification Method   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ISF-BM-001  </td><td class="markdownTableBodyNone"><code>BufferManager</code> shall maintain a fixed-size store and shall provide a callee port on which another component may request and receive variable-size buffers allocated from the store.  </td><td class="markdownTableBodyNone">This requirement provides variable-sized buffers that may be passed between components by reference. Such buffers are useful for transferring large data items of varying length, such as file packets and images. For such data items, a fixed-size buffer such as <code><a class="el" href="class_fw_1_1_com_buffer.html">Fw::ComBuffer</a></code> is not practical.  </td><td class="markdownTableBodyNone">Test   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ISF-BM-002  </td><td class="markdownTableBodyNone"><code>BufferManager</code> shall provide an input port on which a component that has been given a buffer may return the buffer for deallocation.  </td><td class="markdownTableBodyNone">Deallocation prevents the fixed-size store from becoming exhausted. Note that the component returning the buffer is generally the receiver, while the component requesting the buffer is generally the sender. See the <a href="#SequenceDiagram">sequence diagram</a> below.  </td><td class="markdownTableBodyNone">Test   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md179"></a>
3 Design</h2>
<h3><a class="anchor" id="autotoc_md180"></a>
3.1 Assumptions</h3>
<p>The design of <code>BufferManager</code> assumes the following:</p>
<ol type="1">
<li><code>BufferManager</code> has some maximum number of outstanding allocations, set at component initialization, that is never exceeded.</li>
<li>The store maintained by <code>BufferManager</code> has a fixed size, set at component initialization. This fixed size is never exceeded by the outstanding allocations.</li>
<li>Buffers are freed in the same order that they were allocated.</li>
</ol>
<h3><a class="anchor" id="autotoc_md181"></a>
3.2 Block Description Diagram (BDD)</h3>
<p><img src="img/BufferManagerBDD.jpg" alt="`BufferManager` BDD" title="BufferManager" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md182"></a>
3.3 Ports</h3>
<h4><a class="anchor" id="autotoc_md183"></a>
3.3.1 Role Ports</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Role   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>timeCaller</code>  </td><td class="markdownTableBodyNone"><code><a class="el" href="class_fw_1_1_time.html">Fw::Time</a></code>  </td><td class="markdownTableBodyNone">TimeGet   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>tlmOut</code>  </td><td class="markdownTableBodyNone"><a href="../../../Fw/Tlm/docs/sdd.html"><code>Fw::Tlm</code></a>  </td><td class="markdownTableBodyNone">Telemetry   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>eventOut</code>  </td><td class="markdownTableBodyNone"><a href="../../../Fw/Log/docs/sdd.html"><code>Fw::LogEvent</code></a>  </td><td class="markdownTableBodyNone">LogEvent   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md184"></a>
3.3.2 Component-Specific Ports</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Kind  </th><th class="markdownTableHeadNone">Purpose   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="anchor" id="bufferSendIn"></a><code>bufferSendIn</code>  </td><td class="markdownTableBodyNone"><a href="../../../Fw/Buffer/docs/sdd.html"><code>Fw::BufferSend</code></a>  </td><td class="markdownTableBodyNone">guarded input  </td><td class="markdownTableBodyNone">Receives buffers for deallocation   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="anchor" id="bufferGetCallee"></a><code>bufferGetCallee</code>  </td><td class="markdownTableBodyNone"><a href="../../../Fw/Buffer/docs/sdd.html"><code>Fw::BufferGet</code></a>  </td><td class="markdownTableBodyNone">guarded input (callee)  </td><td class="markdownTableBodyNone">Receives requests for allocated buffers and returns the buffers   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md185"></a>
3.4 Constants</h3>
<p><code>BufferManager</code> maintains the following constants, initialized when the component is instantiated:</p>
<ul>
<li><a class="anchor" id="storeSize"></a><em>storeSize</em>: The size of the store used to allocate buffers.</li>
<li><a class="anchor" id="allocationQueueDepth"></a><em>allocationQueueDepth</em>: The maximum number of buffers that may be allocated at any time.</li>
</ul>
<h3><a class="anchor" id="autotoc_md186"></a>
3.5 State</h3>
<p><code>BufferManager</code> maintains the following state:</p>
<ul>
<li><a class="anchor" id="store"></a><em>store</em>: A fixed allocation of <a href="#storeSize"><em>storeSize</em></a> bytes.</li>
<li><a class="anchor" id="allocationQueue"></a><em>allocationQueue</em>: A doubly-ended queue of up to <a href="#allocationQueueDepth"><em>allocationQueueDepth</em></a> entries that maintains, for each outstanding allocation, an entry <em>E = (I, s)</em> consisting of a unique identifier <em>I</em> and a size <em>s</em>.</li>
<li><a class="anchor" id="freeIndex"></a><em>freeIndex</em>: An index pointing to the first free byte of the store. The initial value is zero.</li>
</ul>
<p>The identifiers <em>I</em> are 32-bit unsigned integers.</p>
<h3><a class="anchor" id="autotoc_md187"></a>
3.6 Port Behavior</h3>
<h4><a class="anchor" id="autotoc_md188"></a>
3.6.1 bufferGetCallee</h4>
<p>When <code>BufferManager</code> receives a request for a buffer of size <em>s</em> on <a href="#bufferGetCallee"><em>bufferGetCallee</em></a>, it carries out the following steps:</p>
<ol type="1">
<li>If <em>freeIndex + s &gt; storeSize</em>, then issue a <em>StoreSizeExceeded</em> event and return an invalid buffer.</li>
<li><p class="startli">Otherwise</p>
<p class="startli">a. Assert that the size <em>s'</em> of <a href="#allocationQueue"><em>allocationQueue</em></a> is less than or equal to <a href="#allocationQueueDepth"><em>allocationQueueDepth</em></a>. </p><pre class="fragment">b. If *s' = allocationQueueDepth*, then issue an *AllocationQueueFull*
</pre><p> event and return an invalid buffer. </p><pre class="fragment">c. Otherwise

  1. Create a fresh identifier *I*.

  2. Compute the pointer *P* that points to byte [*freeIndex*](#freeIndex) of [*store*](#store).

  3. Create an allocation queue entry *E = (I, s)*.

  4. Push *E* onto the front of [*allocationQueue*](#allocationQueue).

  5. Increase [*freeIndex*](#freeIndex) by *s*.

  6. Create and return a valid
</pre><p> <a href="../../../Fw/Buffer/docs/sdd.html"><code>Fw::Buffer</code></a> with <code>managerID</code> equal to the instance number of this component, <code>bufferID</code> equal to <em>I</em>, <code>data</code> equal to <em>P</em>, and <code>size</code> equal to <em>s</em>.</p>
</li>
</ol>
<h4><a class="anchor" id="autotoc_md189"></a>
3.6.2 bufferSendIn</h4>
<p>When <code>BufferManager</code> receives notification of a free buffer on <a href="#bufferSendIn"><em>bufferSendIn</em></a>, it carries out the following steps:</p>
<ol type="1">
<li>If <a href="#allocationQueue"><em>allocationQueue</em></a> is empty, then issue an <em>AllocationQueueEmpty</em> event.</li>
<li><p class="startli">Otherwise</p>
<p class="startli">a. Pull an entry *(I, s)* off the back of the queue.</p>
<p class="startli">b. If <em>I</em> matches the identifier provided in the free notification, then decrease <a href="#freeIndex"><em>freeIndex</em></a> by <em>s</em>. </p><pre class="fragment">c. Otherwise issue an *IDMismatch* event.
</pre><p class="startli"><a class="anchor" id="SequenceDiagram"></a> </p>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md190"></a>
3.7 Sequence Diagram</h3>
<p>The following sequence diagram shows the procedure for sending a buffer from one component to another:</p>
<ol type="1">
<li>The sending component requests a buffer <em>B</em> on the <a href="#bufferGetCallee"><code>bufferGetCallee</code></a> port of <code>BufferManager</code>.</li>
<li>The sending component fills <em>B</em> with data and sends it to the receiving component.</li>
<li>The receiving component uses the data in <em>B</em>. When done, it sends <em>B</em> back to the <a href="#bufferSendIn"><code>bufferSendIn</code></a> port of <code>BufferManager</code> for deallocation.</li>
</ol>
<p><img src="img/SendingABuffer.jpg" alt="`BufferManager` Sending a Buffer" title="SequenceDiagram" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md191"></a>
4 Dictionary</h2>
<p>Dictionaries: <a href="BufferManager.html">HTML</a> MD</p>
<h2><a class="anchor" id="autotoc_md192"></a>
5 Checklists</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Document  </th><th class="markdownTableHeadNone">Link   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Design  </td><td class="markdownTableBodyNone"><a href="Checklist/design.xlsx">Link</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Code  </td><td class="markdownTableBodyNone"><a href="Checklist/code.xlsx">Link</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Unit Test  </td><td class="markdownTableBodyNone"><a href="Checklist/unit_test.xls">Link</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md193"></a>
6 Unit Testing</h2>
<p>TODO </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_svc.html">Svc Compontents Ports and Classes</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19 </li>
  </ul>
</div>
</body>
</html>
