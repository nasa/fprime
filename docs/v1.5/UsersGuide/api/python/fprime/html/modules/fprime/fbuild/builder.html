

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fprime.fbuild.builder &mdash; fprime 1.4.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/css/rtd_width.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
        <script src="../../../static/jquery.js"></script>
        <script src="../../../static/underscore.js"></script>
        <script src="../../../static/doctools.js"></script>
        <script src="../../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> fprime
          

          
          </a>

          
            
            
              <div class="version">
                1.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">fprime</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>fprime.fbuild.builder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for fprime.fbuild.builder</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Supplies high-level build functions to the greater fprime helper CLI. This maps from user command space to the specific</span>
<span class="sd">build system handler underneath.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">fprime.common.error</span> <span class="kn">import</span> <span class="n">FprimeException</span>
<span class="kn">from</span> <span class="nn">fprime.fbuild.settings</span> <span class="kn">import</span> <span class="n">IniSettings</span>
<span class="kn">from</span> <span class="nn">fprime.fbuild.cmake</span> <span class="kn">import</span> <span class="n">CMakeHandler</span><span class="p">,</span> <span class="n">CMakeException</span>


<div class="viewcode-block" id="BuildType"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BuildType">[docs]</a><span class="k">class</span> <span class="nc">BuildType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An enumeration used to represent the various build types used to build fprime. These types can support different</span>
<span class="sd">    types of targets underneath. i.e. the unit-test build may build unit test executables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="sd">&quot;&quot;&quot; Normal build normal binaries for a deployment mapping to CMake &#39;Release&#39;&quot;&quot;&quot;</span>  <span class="c1"># pylint: disable=W0105</span>
<div class="viewcode-block" id="BuildType.BUILD_NORMAL"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BuildType.BUILD_NORMAL">[docs]</a>    <span class="n">BUILD_NORMAL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span></div>
    <span class="sd">&quot;&quot;&quot; Testing build allowing unit testing mapping to CMake &#39;Testing&#39;&quot;&quot;&quot;</span>  <span class="c1"># pylint: disable=W0105</span>
<div class="viewcode-block" id="BuildType.BUILD_TESTING"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BuildType.BUILD_TESTING">[docs]</a>    <span class="n">BUILD_TESTING</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="BuildType.get_suffix"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BuildType.get_suffix">[docs]</a>    <span class="k">def</span> <span class="nf">get_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the suffix of a directory supporting this build &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_NORMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;-ut&quot;</span>
        <span class="k">raise</span> <span class="n">InvalidBuildTypeException</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a supported build type&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="BuildType.get_cmake_build_type"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BuildType.get_cmake_build_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_cmake_build_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the suffix of a directory supporting this build &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_NORMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Release&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Testing&quot;</span>
        <span class="k">raise</span> <span class="n">InvalidBuildTypeException</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a supported build type&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div></div>
        <span class="p">)</span>


<div class="viewcode-block" id="Target"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target">[docs]</a><span class="k">class</span> <span class="nc">Target</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic build target base class</span>

<span class="sd">    A target can be specified by the user using a mnemonic and flags. The mnemonic is the command typed in by the user,</span>
<span class="sd">    and the flags allow the user to remember fewer mnemonics by changing the build target using a modifier. Each build</span>
<span class="sd">    target is available in certain build types.</span>

<span class="sd">    Targets can be global, using the GlobalTarget base class. Global targets don&#39;t use contextual information to modify</span>
<span class="sd">    the target, but apply to the whole deployment. Note: global targets are also engaged at the deployment level should</span>
<span class="sd">    that be the context.</span>

<span class="sd">    Targets may also be local. These targets use context information to figure out what to build. This allows for one</span>
<span class="sd">    target to represent a class of targets. i.e. build can be used as a local target to build any given sub directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mnemonic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">build_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BuildType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">flags</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cmake</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs a build target</span>

<span class="sd">        Args:</span>
<span class="sd">            mnemonic:    mnemonic used to engage build targets. Is not unique, but mnemonic + flags must be.</span>
<span class="sd">            desc:        help description of this build target</span>
<span class="sd">            build_types: supported build types for target. Defaults to [BuildType.BUILD_NORMAL, BuildType.BUILD_TESTING]</span>
<span class="sd">            flags:       flags used to uniquely identify build targets who share logical mnemonics. Defaults to None.</span>
<span class="sd">            cmake:       cmake target override to handle oddly named cmake targets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="n">mnemonic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">build_types</span>
            <span class="k">if</span> <span class="n">build_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_NORMAL</span><span class="p">,</span> <span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmake_target</span> <span class="o">=</span> <span class="n">cmake</span> <span class="k">if</span> <span class="n">cmake</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mnemonic</span>

<div class="viewcode-block" id="Target.__str__"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Makes this target into a string &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Target.config_string"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target.config_string">[docs]</a>    <span class="k">def</span> <span class="nf">config_string</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts a mnemonic and set of flags to string</span>

<span class="sd">        Args:</span>
<span class="sd">            mnemonic: mnemonic of the target</span>
<span class="sd">            flags: sset of flags to pair with mnemonic</span>
<span class="sd">        Returns:</span>
<span class="sd">            string of format &quot;mnemonic --flag1 --flag2 ...&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flag_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;--</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">])</span>
        <span class="n">flag_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">flag_string</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">flag_string</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">,</span> <span class="n">flag_string</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Target.get_all_possible_flags"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target.get_all_possible_flags">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_possible_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Gets list of all targets&#39; flags used</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of targets&#39;s supported by the system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">agg</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">agg</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span></div>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Target.get_all_targets"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target.get_all_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_targets</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Target&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Gets list of all targets registered</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of targets supported by the system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BUILD_TARGETS</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Target.get_target"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Target.get_target">[docs]</a>    <span class="k">def</span> <span class="nf">get_target</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Target&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the actual build target given the parsed namespace</span>

<span class="sd">        Using the global list of build targets and the flags supplied to the namespace, attempt to determine which build</span>
<span class="sd">        targets can be used. If more than one are found, then generate exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            mnemonic: mnemonic of command to look for</span>
<span class="sd">            flags:    flags to narrow down target</span>

<span class="sd">        Returns:</span>
<span class="sd">            single matching target</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># matching = [target for target in cls.get_all_targets() if target.mnemonic == mnemonic and flags == target.flags]</span>
        <span class="n">matching</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">mnemonic</span> <span class="ow">and</span> <span class="n">flags</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
                <span class="n">matching</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matching</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchTargetException</span><span class="p">(</span>
                <span class="s2">&quot;Could not find target &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">config_string</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">,</span> <span class="n">flags</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Conflicting targets specified in code&quot;</span>
        <span class="k">return</span> <span class="n">matching</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="GlobalTarget"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.GlobalTarget">[docs]</a><span class="k">class</span> <span class="nc">GlobalTarget</span><span class="p">(</span><span class="n">Target</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot;Represents a global build target</span>

<span class="sd">    Build targets are global if they do not apply to a specific directory, but rather to a full deployment.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<div class="viewcode-block" id="LocalTarget"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.LocalTarget">[docs]</a><span class="k">class</span> <span class="nc">LocalTarget</span><span class="p">(</span><span class="n">Target</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot;Represents a local build target</span>

<span class="sd">    Build targets are local if they do  apply to a specific directory whose context drives the build setup.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<div class="viewcode-block" id="Build"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build">[docs]</a><span class="k">class</span> <span class="nc">Build</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Represents a build configuration</span>

<span class="sd">    Builds in FÂ´ consist of a build type (normal, testing), a deployment directory, a set of settings, and a target</span>
<span class="sd">    platform. These are tracked as part of this Build class. This helps setup a build cache directory, load default</span>
<span class="sd">    settings, and track what type of build is being run.</span>

<span class="sd">    BuildType represents the type of build as explained in that enum type.</span>
<span class="sd">    Deployments are an individual build of fprime, and should define the CMakeLists.txt file as a child of this</span>
<span class="sd">    directory. A default settings.ini file may be found here.</span>
<span class="sd">    Platforms represent the target hardware to build from. This is translated to the CMake toolchain file.</span>

<span class="sd">    After creation, a user must use invent to handle new builds (e.g. during the generation step), or load to load a</span>
<span class="sd">    previously generated build.</span>

<span class="sd">    Examples:</span>
<span class="sd">        To use in generation run the following code.</span>

<span class="sd">        build = Build(BuildType.BUILD_NORMAL, path/to/deployment)</span>
<span class="sd">        build.invent(&quot;raspberrypi&quot;)</span>

<span class="sd">        To use at any step after generation:</span>

<span class="sd">        build = Build(BuildType.BUILD_NORMAL, path/to/deployment)</span>
<span class="sd">        build.load()</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Build.VALID_CMAKE_LIST"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.VALID_CMAKE_LIST">[docs]</a>    <span class="n">VALID_CMAKE_LIST</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?sm)^\s*project\(.*\)&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="Build.CMAKE_DEFAULT_BUILD_NAME"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.CMAKE_DEFAULT_BUILD_NAME">[docs]</a>    <span class="n">CMAKE_DEFAULT_BUILD_NAME</span> <span class="o">=</span> <span class="s2">&quot;build-fprime-automatic-</span><span class="si">{platform}{suffix}</span><span class="s2">&quot;</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_type</span><span class="p">:</span> <span class="n">BuildType</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs a build object from its constituent parts</span>

<span class="sd">        Args:</span>
<span class="sd">            build_type: member of the enum BuildType specifying fprime build type</span>
<span class="sd">            deployment: path to deployment that this build represents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_type</span> <span class="o">=</span> <span class="n">build_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">=</span> <span class="n">deployment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span> <span class="o">=</span> <span class="n">CMakeHandler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>

<div class="viewcode-block" id="Build.invent"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.invent">[docs]</a>    <span class="k">def</span> <span class="nf">invent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Invents a build path from a given platform</span>

<span class="sd">        Sets this build up as a new build that would be used as as part of a generate step. This directory must not</span>
<span class="sd">        already exist. If platform is None, a default will be chosen from the settings.ini file. If the settings.ini</span>
<span class="sd">        file does not exist, or does not specify a default_toolchain, then &quot;native&quot; will be used. Settings are loaded in</span>
<span class="sd">        this step for further uses of this build.</span>

<span class="sd">        build_dir is used to specify an exact build directory to use as part of this step. This allows directories to be</span>
<span class="sd">        specified by the caller, but is typically not used.</span>

<span class="sd">        Args:</span>
<span class="sd">            platform:   name of platform to build against. None will use default from settings.ini or without this</span>
<span class="sd">                        setting, &quot;native&quot;. Defaults to None.</span>
<span class="sd">            build_dir:  explicitly sets the build path to allow for user override of default</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidBuildCacheException: a build cache already exists as it should not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setup_default</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidBuildCacheException</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> already exists.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">)</span></div>
            <span class="p">)</span>

<div class="viewcode-block" id="Build.load"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load an existing build cache</span>

<span class="sd">        Sets this build up from an existing build cache. This can be used after a previous run that has generated a</span>
<span class="sd">        build cache in order to prepare for other build steps.</span>

<span class="sd">        Args:</span>
<span class="sd">            platform:   name of platform to build against. None will use default from settings.ini or without this</span>
<span class="sd">                        setting, &quot;native&quot;. Defaults to None.</span>
<span class="sd">            build_dir:  explicitly sets the build path to allow for user override of default</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidBuildCacheException: the build cache does not exist as it must</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setup_default</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">/</span> <span class="s2">&quot;CMakeCache.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidBuildCacheException</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> invalid build cache. Please (re)generate.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">build_dir</span><span class="p">)</span></div>
            <span class="p">)</span>

<div class="viewcode-block" id="Build.get_settings"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.get_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">default</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Fetches settings in the settings file</span>

<span class="sd">        Reads settings loaded from the settings file and returns them to the caller. If a single string is submitted,</span>
<span class="sd">        then a single string is returned. If a list of strings is submitted a list is returned. default provides default</span>
<span class="sd">        values to supply in the case that a setting is unavailable.</span>

<span class="sd">        Args:</span>
<span class="sd">            setting: a string or set of string settings to return</span>
<span class="sd">            default: a string or set of string settings to return if no setting is found</span>

<span class="sd">        Returns:</span>
<span class="sd">            a single string setting or a list of string settings to match request with defaults subbed ins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">back</span><span class="p">)</span> <span class="k">for</span> <span class="n">req</span><span class="p">,</span> <span class="n">back</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="n">default</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Build.find_hashed_file"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.find_hashed_file">[docs]</a>    <span class="k">def</span> <span class="nf">find_hashed_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieves the file associated with a hash</span>

<span class="sd">        In order to reduce space and memory footprint, filenames are associated with hashes automatically as part of the</span>
<span class="sd">        build. This function will retrieve the file name given a has integer.</span>

<span class="sd">        Args:</span>
<span class="sd">            hash_value: hash number to lookup</span>

<span class="sd">        Returns:</span>
<span class="sd">            stored file path(s) associated with hash</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hashes_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">/</span> <span class="s2">&quot;hashes.txt&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hashes_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidBuildCacheException</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find </span><span class="si">{}</span><span class="s2">, was the build generated.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hashes_file</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hashes_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">line</span><span class="p">,</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="Build.get_build_cache"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.get_build_cache">[docs]</a>    <span class="k">def</span> <span class="nf">get_build_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generates build cache path for this build</span>

<span class="sd">        Generates the build path for this build. This will expect a valid build path to exist unless validate is</span>
<span class="sd">        specified as false. A valid build cache has been created from the generate step, and thus when using this call</span>
<span class="sd">        as part of the generate step, validate should be set to false.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to a build cache directory</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">/</span> <span class="n">Build</span><span class="o">.</span><span class="n">CMAKE_DEFAULT_BUILD_NAME</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">platform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_suffix</span><span class="p">()</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="Build.get_build_info"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.get_build_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_build_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructs an informational packet about this build</span>

<span class="sd">        Constructs a packet that allows for users to get meta-build information. This includes: location of build, file</span>
<span class="sd">        and other constructs, available make targets, and other items.</span>

<span class="sd">        Args:</span>
<span class="sd">            context: contextual path to list various information about the build</span>

<span class="sd">        Returns:</span>
<span class="sd">            Build information dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_cmake_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">get_available_targets</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">),</span> <span class="n">context</span>
        <span class="p">)</span>
        <span class="n">local_targets</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">target</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">BUILD_TARGETS</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">cmake_target</span> <span class="ow">in</span> <span class="n">valid_cmake_targets</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">LocalTarget</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">global_targets</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">target</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">BUILD_TARGETS</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">GlobalTarget</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_type</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">build_types</span>
        <span class="p">]</span>

        <span class="n">relative_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">get_project_relative_path</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">possible</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;F-Prime&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">]:</span>
            <span class="n">auto_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">/</span> <span class="n">possible</span> <span class="o">/</span> <span class="n">relative_path</span>
            <span class="k">if</span> <span class="n">auto_location</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auto_location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;local_targets&quot;</span><span class="p">:</span> <span class="n">local_targets</span><span class="p">,</span>
            <span class="s2">&quot;global_targets&quot;</span><span class="p">:</span> <span class="n">global_targets</span><span class="p">,</span>
            <span class="s2">&quot;auto_location&quot;</span><span class="p">:</span> <span class="n">auto_location</span><span class="p">,</span></div>
        <span class="p">}</span>

<div class="viewcode-block" id="Build.find_toolchain"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.find_toolchain">[docs]</a>    <span class="k">def</span> <span class="nf">find_toolchain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locates a toolchain file in know locations</span>

<span class="sd">        Finds a toolchain for the given platform.  Searches in known locations for the toolchain, and compares against F</span>
<span class="sd">        prime provided toolchains, toolchains in libraries, and toolchains provided by project.</span>

<span class="sd">        Returns:</span>
<span class="sd">            path to CMake toolchain file or None to use builtin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;Default toolchain should have been decided already&quot;</span>
        <span class="n">toolchain_locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;framework_path&quot;</span><span class="p">,</span> <span class="s2">&quot;project_root&quot;</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">toolchain_locations</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="s2">&quot;library_locations&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># If toolchain is the native target, this is supplied by CMake and we exit here.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;native&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Otherwise, find locations of toolchain files using the specified locations from settings.</span>
        <span class="n">toolchains_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="s2">&quot;cmake&quot;</span><span class="p">,</span> <span class="s2">&quot;toolchain&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">+</span> <span class="s2">&quot;.cmake&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">toolchain_locations</span>
            <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="c1"># Create a deduplicated set of toolchains</span>
        <span class="n">toolchains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">toolchain_path</span>
                <span class="k">for</span> <span class="n">toolchain_path</span> <span class="ow">in</span> <span class="n">toolchains_paths</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toolchain_path</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">toolchains</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchToolchainException</span><span class="p">(</span>
                <span class="s2">&quot;Could not find toolchain file for </span><span class="si">{}</span><span class="s2"> at any of: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toolchains_paths</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toolchains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AmbiguousToolchainException</span><span class="p">(</span>
                <span class="s2">&quot;Found conflicting toolchain files for </span><span class="si">{}</span><span class="s2"> at: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toolchains</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">toolchains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Build.execute"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Target</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">make_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute a build target</span>

<span class="sd">        Executes a target within the build system. This will execute the target by calling into the make system. Context</span>
<span class="sd">        is supplied such that the system can match local targets to the global target list.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: target to run</span>
<span class="sd">            context: context path for local targets</span>
<span class="sd">            make_args: make system arguments directly supplied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">execute_known_target</span><span class="p">(</span>
            <span class="n">target</span><span class="o">.</span><span class="n">cmake_target</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">,</span>
            <span class="n">context</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span>
            <span class="n">make_args</span><span class="o">=</span><span class="n">make_args</span><span class="p">,</span>
            <span class="n">top_target</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">GlobalTarget</span><span class="p">),</span></div>
        <span class="p">)</span>

<div class="viewcode-block" id="Build.generate"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmake_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a build given CMake arguments</span>

<span class="sd">        This will run a generate step of the cmake build process. This will take in any argument used/passed to CMake.</span>

<span class="sd">        Args:</span>
<span class="sd">            cmake_args: cmake arguments to pass into the generate step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Pass in needed F prime settings for the build read out of settings.ini</span>
            <span class="n">needed</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_FRAMEWORK_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;framework_path&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_LIBRARY_LOCATIONS&quot;</span><span class="p">,</span> <span class="s2">&quot;library_locations&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_PROJECT_ROOT&quot;</span><span class="p">,</span> <span class="s2">&quot;project_root&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_SETTINGS_FILE&quot;</span><span class="p">,</span> <span class="s2">&quot;settings_file&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_ENVIRONMENT_FILE&quot;</span><span class="p">,</span> <span class="s2">&quot;environment_file&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_AC_CONSTANTS_FILE&quot;</span><span class="p">,</span> <span class="s2">&quot;ac_constants&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;FPRIME_CONFIG_DIR&quot;</span><span class="p">,</span> <span class="s2">&quot;config_dir&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="n">cmake_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">cache</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cache</span><span class="p">,</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">needed</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">cmake_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;CMAKE_BUILD_TYPE&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_type</span><span class="o">.</span><span class="n">get_cmake_build_type</span><span class="p">()}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">generate_build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">,</span> <span class="n">cmake_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CMakeException</span> <span class="k">as</span> <span class="n">cexc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GenerateException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cexc</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">cexc</span></div>

<div class="viewcode-block" id="Build.purge"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.purge">[docs]</a>    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Purge a build cache directory &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="n">purge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Build.find_nearest_deployment"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.find_nearest_deployment">[docs]</a>    <span class="k">def</span> <span class="nf">find_nearest_deployment</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Recurse up the directory stack looking for a valid deployment</span>

<span class="sd">        Recurse up the directory tree from the given path, looking for a deployment definition directory. This means it</span>
<span class="sd">        defines a CMakeLists.txt with a project call. This finds where the automatic build directories are allowed to</span>
<span class="sd">        exist.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This replaced the former build directory recursive detector as that can &quot;slip&quot; past a deployment should the</span>
<span class="sd">            build directory not be generated yet.</span>

<span class="sd">        Returns;</span>
<span class="sd">            Path to the nearest deployment directory searching up the directory tree</span>

<span class="sd">        Raises;</span>
<span class="sd">            UnableToDetectDeploymentException: was unable to detect a deployment directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">list_file</span> <span class="o">=</span> <span class="n">full_path</span> <span class="o">/</span> <span class="s2">&quot;CMakeLists.txt&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">parents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnableToDetectDeploymentException</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">list_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">list_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">file_handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Build</span><span class="o">.</span><span class="n">VALID_CMAKE_LIST</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">full_path</span>
        <span class="k">return</span> <span class="n">Build</span><span class="o">.</span><span class="n">find_nearest_deployment</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="Build.__setup_default"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.Build.__setup_default">[docs]</a>    <span class="k">def</span> <span class="nf">__setup_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up default build</span>

<span class="sd">        Sets this build up before determining if it is a pre-generated, or post-generated build.</span>

<span class="sd">        build_dir is used to specify an exact build directory to use as part of this step. This allows directories to be</span>
<span class="sd">        specified by the caller, but is typically not used.</span>

<span class="sd">        Args:</span>
<span class="sd">            platform:   name of platform to build against. None will use default from settings.ini or without this</span>
<span class="sd">                        setting, &quot;native&quot;. Defaults to None.</span>
<span class="sd">            build_dir:  explicitly sets the build path to allow for user override of default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Already setup it is invalid to re-setup&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Already setup it is invalid to re-setup&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Already setup it is invalid to re-setup&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">IniSettings</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">/</span> <span class="s2">&quot;settings.ini&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">platform</span>
            <span class="k">if</span> <span class="n">platform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default_toolchain&quot;</span><span class="p">,</span> <span class="s2">&quot;native&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">=</span> <span class="n">build_dir</span> <span class="k">if</span> <span class="n">build_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_build_cache</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="GenerateException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.GenerateException">[docs]</a><span class="k">class</span> <span class="nc">GenerateException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; An exception indicating generate has failed and the user may need to respond &quot;&quot;&quot;</span>


<div class="viewcode-block" id="InvalidBuildTypeException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.InvalidBuildTypeException">[docs]</a><span class="k">class</span> <span class="nc">InvalidBuildTypeException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; An exception indicating a build type do not exit &quot;&quot;&quot;</span>


<div class="viewcode-block" id="InvalidBuildCacheException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.InvalidBuildCacheException">[docs]</a><span class="k">class</span> <span class="nc">InvalidBuildCacheException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; An exception indicating a build cache &quot;&quot;&quot;</span>


<div class="viewcode-block" id="UnableToDetectDeploymentException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.UnableToDetectDeploymentException">[docs]</a><span class="k">class</span> <span class="nc">UnableToDetectDeploymentException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; An exception indicating a build cache &quot;&quot;&quot;</span>


<div class="viewcode-block" id="NoValidBuildTypeException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.NoValidBuildTypeException">[docs]</a><span class="k">class</span> <span class="nc">NoValidBuildTypeException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; An build type matching the user request could not be found &quot;&quot;&quot;</span>


<div class="viewcode-block" id="NoSuchTargetException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.NoSuchTargetException">[docs]</a><span class="k">class</span> <span class="nc">NoSuchTargetException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; Could not find a matching build target &quot;&quot;&quot;</span>


<div class="viewcode-block" id="NoSuchToolchainException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.NoSuchToolchainException">[docs]</a><span class="k">class</span> <span class="nc">NoSuchToolchainException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; Could not find a matching build target &quot;&quot;&quot;</span>


<div class="viewcode-block" id="AmbiguousToolchainException"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.AmbiguousToolchainException">[docs]</a><span class="k">class</span> <span class="nc">AmbiguousToolchainException</span><span class="p">(</span><span class="n">FprimeException</span><span class="p">):</span></div>
    <span class="sd">&quot;&quot;&quot; Could not find a matching build target &quot;&quot;&quot;</span>


<span class="sd">&quot;&quot;&quot; Defined set of build targets available to the system&quot;&quot;&quot;</span>  <span class="c1"># pylint: disable=W0105</span>
<div class="viewcode-block" id="BUILD_TARGETS"><a class="viewcode-back" href="../../../api/fprime/fbuild/builder/index.html#fprime.fbuild.builder.BUILD_TARGETS">[docs]</a><span class="n">BUILD_TARGETS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Various &quot;build&quot; target</span>
    <span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;build&quot;</span><span class="p">,</span> <span class="s2">&quot;Build components, ports, and deployments&quot;</span><span class="p">,</span> <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
    <span class="n">GlobalTarget</span><span class="p">(</span><span class="s2">&quot;build&quot;</span><span class="p">,</span> <span class="s2">&quot;Build all deployment targets&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;all&quot;</span><span class="p">},</span> <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">),</span>
    <span class="n">LocalTarget</span><span class="p">(</span>
        <span class="s2">&quot;build&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Build unit tests&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ut&quot;</span><span class="p">},</span>
        <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;ut_exe&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="c1"># Implementation targets</span>
    <span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;impl&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate implementation template files&quot;</span><span class="p">),</span>
    <span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;impl&quot;</span><span class="p">,</span> <span class="s2">&quot;Generate unit test files&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ut&quot;</span><span class="p">},</span> <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;testimpl&quot;</span><span class="p">),</span>
    <span class="c1"># Check targets and unittest targets</span>
    <span class="n">LocalTarget</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="s2">&quot;Run unit tests&quot;</span><span class="p">,</span> <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">]),</span>
    <span class="n">LocalTarget</span><span class="p">(</span>
        <span class="s2">&quot;check&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Run unit tests with memory checking&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;leak&quot;</span><span class="p">},</span>
        <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;check_leak&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">GlobalTarget</span><span class="p">(</span>
        <span class="s2">&quot;check&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Run all deployment unit tests&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;all&quot;</span><span class="p">},</span>
    <span class="p">),</span>
    <span class="n">GlobalTarget</span><span class="p">(</span>
        <span class="s2">&quot;check&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Run all deployment unit tests with memory checking&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;leak&quot;</span><span class="p">},</span>
        <span class="n">cmake</span><span class="o">=</span><span class="s2">&quot;check_leak&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">LocalTarget</span><span class="p">(</span>
        <span class="s2">&quot;coverage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Generate unit test coverage reports&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_TESTING</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="c1"># Installation target</span>
    <span class="n">GlobalTarget</span><span class="p">(</span>
        <span class="s2">&quot;install&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Install the current deployment build artifacts&quot;</span><span class="p">,</span>
        <span class="n">build_types</span><span class="o">=</span><span class="p">[</span><span class="n">BuildType</span><span class="o">.</span><span class="n">BUILD_NORMAL</span><span class="p">],</span></div>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Michael Starch

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
